---
title: amazon spide（邮编请求）
date: 2020-11-06 14:30:39
tags: 
    - amazon
    - spider
    - zipCode
categories:
  - spider
id: spider0001
keywords: 'amazon,spider,亚马逊,爬虫,邮编'
---

# amazon spide（邮编请求）

## 背景
> amazon 使用关键词搜索的过程中，会将不发货到默认地址（本地IP）的商品剔除。这样的爬虫数据没有意义，运营人员需要获取当地用户的视角，来判断商品目前的价值。

数据对比，可以看到商品信息和广告信息都是不一样的。
> 美国邮编下的展示
![数据对比 美国邮编](1604646349462.jpg)

> 中国收货地址的展示
![数据对比 中国邮编](1604646491996.jpg)

## 解决方案
> 两种不需要用户登陆的解决方式。

方法|优点|缺点
---|:--|:---
使用当地IP| 不需要修改爬虫任务  | 爬虫部署复杂 <br> 对应成本增加
***使用IP绑定session***| 需要增加爬虫前置逻辑 <br> 增加邮编检查 </br> | 成本低

## 编写程序

> 下面会讲解如何使用IP 去绑定session ,并请求相关数据。

### 用户如何处理

> 首先我们需要知道用户是如何操作的。以 US 站点为例，以用户的方式设置邮编为 **10010**
![确定邮编](1604645900300.jpg)

### 判断

> 用户在**没有登陆**的情况下选择了邮编，获取就是当地数据。那么这个邮编信息要么是在cookie（本地），要么是在session （亚马逊服务器）中。

![cookie 信息](1604647213316.jpg)

> cookie中并没有相关邮编信息，我们初步判断邮编信息是在 session中。
> **删除 session-id** 的值，然后刷新页面查看数据，果然邮编就恢复到了默认的IP地址，可以确定 邮编信息是在session 中。

通过F12查看浏览器如何获取session，程序的流程：
![邮政信息获取设计](邮政信息获取设计.jpg)

最后持有session和代理请求出来的页面，就是相对应的站点数据。

## 注意点
1. 使用的**代理**最好是高质量的私密代理
2. 使用同一个**代理** 获取csrf验证的token,再时候这个代理选择邮编,最后也是使用这个代理获取相关页面。
3. 获取到页面后也需要相关的检查工具，来验证session 是否失效。
